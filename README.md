# 画像整列アプリ

複数画像を指定領域に合わせて自動整列するWebアプリケーションです。OpenCV.jsを使用した特徴点マッチングにより、画像の位置、回転、スケールを自動調整します。

## 主な機能

### 画像管理
- **複数画像アップロード**: ドラッグ&ドロップまたはファイル選択で複数画像をアップロード
- **自動ファイル名ソート**: ファイル名の数字を認識して自動的に順序付け
- **画像リスト表示**: アップロード済み画像の一覧表示と選択

### 画像整列
- **領域選択モード**: 画像上で整列対象の領域を矩形選択
- **変形モード**: 手動で画像の位置、回転、スケールを調整
- **自動整列**: OpenCV.jsによる特徴点マッチングで全画像を自動整列
- **上下合わせ**: 選択領域の位置のみを調整
- **回転調整**: 回転のみを自動調整

### 画像変換
- **変換パラメータ方式**: 画像データ自体は変更せず、変換パラメータのみ保持
- **Canvas描画時適用**: 表示時に変換パラメータを適用して描画
- **メモリ効率化**: 元画像データを保持し、変換済み画像の重複保存を回避

### 画像出力
- **一括画像出力**: 変換パラメータを適用した全画像をZipファイルでダウンロード
- **単一画像ダウンロード**: 選択中の画像を個別にダウンロード
- **TextureAtlas出力**: 画像を正方形に切り取り、指定サイズのタイルに配置してアトラス画像を生成

### UI/UX改善
- **2列レイアウト**: ボタン群を左側、スライダー群を右側に配置
- **細かい回転制御**: 回転スライダーの刻みを0.1度に設定
- **テキスト入力対応**: 回転値をスライダーとテキスト入力の両方で指定可能
- **レスポンシブデザイン**: 画面サイズに応じたレイアウト調整

## 技術仕様

### フロントエンド
- **React 18**: モダンなUIフレームワーク
- **TypeScript**: 型安全性の確保
- **Vite**: 高速な開発環境とビルド
- **OpenCV.js**: 画像処理と特徴点マッチング
- **JSZip**: 画像の一括ダウンロード機能

### 画像処理
- **ORB特徴点抽出**: 回転・スケール不変な特徴点検出
- **BFMatcher**: 特徴点マッチングアルゴリズム
- **アフィン変換**: 位置、回転、スケールの統合変換
- **Canvas描画**: 変換パラメータの適用と表示

### ファイル形式
- **入力**: JPEG, PNG, GIF, WebP等の主要画像形式
- **出力**: PNG形式（透明度対応）

## インストールと実行

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# 本番ビルド
npm run build
```

## 使用方法

1. **画像アップロード**: 複数画像をドラッグ&ドロップまたはファイル選択でアップロード
2. **領域選択**: 各画像で整列対象の領域を矩形選択
3. **自動整列**: 「自動整列」ボタンで全画像を一括整列
4. **手動調整**: 必要に応じて個別に位置、回転、スケールを調整
5. **画像出力**: 「画像出力」で変換済み画像を一括ダウンロード
6. **TextureAtlas出力**: 「TextureAtlas出力」でアトラス画像を生成

## ファイル構成

```
src/
├── components/
│   ├── ImageUploader.tsx      # 画像アップロード機能
│   ├── ImageCanvas.tsx        # 画像表示と領域選択
│   ├── AlignmentControls.tsx  # 変形制御と整列ボタン
│   └── TextureAtlasDialog.tsx # TextureAtlas設定ダイアログ
├── utils/
│   ├── imageAlignment.ts      # OpenCV.jsによる整列処理
│   ├── imageTransform.ts      # アフィン変換計算
│   ├── imageExport.ts         # 画像出力機能
│   └── textureAtlas.ts       # TextureAtlas生成
└── App.tsx                    # メインアプリケーション
```

## ライセンス

MIT License
